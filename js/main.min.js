const date=new Date;let year=date.getFullYear(),month=date.getMonth();const calendar=document.querySelector(".calendar__body"),currMonthAndYear=document.querySelector(".month-control__month-name"),buttonPrev=document.querySelector(".month-control__button--prev"),buttonNext=document.querySelector(".month-control__button--next"),popup=document.querySelector(".popup"),addEvent=document.querySelector(".popup--new"),addEventForm=addEvent.querySelector(".form"),eventDate=addEvent.querySelector(".form__input--date"),eventTittle=addEvent.querySelector(".form__input--event"),eventPartisipants=addEvent.querySelector(".form__input--participants"),closePopup=addEvent.querySelector(".popup__close-button"),weekdays=["Понедельник, ","Вторник, ","Среда, ","Четверг, ","Пятница, ","Суббота, ","Воскресенье, "],getLastDayOfMonth=(e,t)=>new Date(e,t+1,0).getDate(),getFirstWeekDayOfMonth=(e,t)=>new Date(e,t).getDay(),getLastWeekDayOfMonth=(e,t)=>new Date(e,t+1,0).getDay(),getShiftElemNum=(e,t)=>{let n=getFirstWeekDayOfMonth(e,t);return 0===n?6:n-1},getPushElemNum=(e,t)=>{let n=getLastWeekDayOfMonth(e,t);return 0===n?0:7-n},getDaysOfPrevMonth=(e,t)=>{let n=new Date(e,t,0).getDate(),a=[];for(;a.length!==getShiftElemNum(e,t);)a.push(n),n-=1;return a.reverse(),a},getDaysOfNextMonth=(e,t)=>{let n=new Date(e,t,1).getDate(),a=[];for(;a.length!==getPushElemNum(e,t);)a.push(n),n+=1;return a},getDates=(e,t)=>{let n=[],a=[],r=getDaysOfPrevMonth(e,t),o=getDaysOfNextMonth(e,t);for(let n=1;n<=getLastDayOfMonth(e,t);n++)a.push(n);return n=r.concat(a,o),n},getMonthName=e=>["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"][e],monthDeclension=e=>{let t;return t=2===e||7==e?getMonthName(e).concat("а"):getMonthName(e).substring(0,getMonthName(e).length-1).concat("я"),t},showCurrMonthAndYear=(e,t,n)=>{n.textContent=`${getMonthName(t)} ${e}`},getPrevYear=(e,t)=>0===t?e-1:e,getPrevMonth=e=>0===e?11:e-1,getNextYear=(e,t)=>11===t?e+1:e,getNextMonth=e=>11===e?0:e+1,showPrevMonthAndYear=()=>{year=getPrevYear(year,month),month=getPrevMonth(month),element=calendar,addEvent.classList.contains("popup--show")&&addEvent.classList.remove("popup--show"),renderCalendar(year,month,element)},showNextMonthAndYear=()=>{element=calendar,year=getNextYear(year,month),month=getNextMonth(month),renderCalendar(year,month,element),addEvent.classList.contains("popup--show")&&addEvent.classList.remove("popup--show")},createElement=(e,t,n,a)=>{let r=document.createElement(e);t&&r.classList.add(t),a&&(r.textContent+=a),n.appendChild(r)},showPopup=(e,t)=>{e.forEach((n=>{n.addEventListener("click",(()=>{for(let n=0;n<e.length;n++)e[n].classList.contains(t)&&e[n].classList.remove(t);n.classList.add(t);const a=()=>{clearForm(),n.classList.remove(t),addEvent.classList.remove("popup--show"),addEvent.style.left="",addEvent.style.top="",closePopup.removeEventListener("click",a),addEventForm.removeEventListener("submit",r)},r=e=>{e.preventDefault(),createElement("div","event",n);const o=n.querySelector(".event"),l=eventTittle.value,s=eventPartisipants.value;createElement("span","event__tittle",o,l),createElement("span","event__description",o,s),n.classList.add("calendar__day--event"),clearForm(),n.classList.remove(t),addEvent.classList.remove("popup--show"),closePopup.removeEventListener("click",a),addEventForm.removeEventListener("submit",r)};n.classList.contains("calendar__day--event")||(addEvent.classList.add("popup--show"),addEvent.style.left=n.getBoundingClientRect().right+"px",addEvent.style.top=n.getBoundingClientRect().top+"px",fillDate(n),closePopup.addEventListener("click",a),addEventForm.addEventListener("submit",r))}))}))},clearForm=()=>{eventTittle.value="",eventPartisipants.value="",eventDate.value=""},fillDate=e=>{let t=e.querySelector(".calendar__date");eventDate.value=`${t.textContent} ${monthDeclension(month)} ${year}`},renderDates=(e,t,n)=>{n.innerHTML="";let a=getDates(e,t);createElement("table","calendar__month",calendar);let r=document.querySelector(".calendar__month");createElement("tbody",!1,r);let o=document.querySelector("tbody");for(let e=0;e<Math.floor(a.length/7);e++)createElement("tr","calendar__week",o);let l=document.querySelectorAll(".calendar__week");for(let e=0;e<l.length;e++)for(let t=0;t<7;t++)createElement("td","calendar__day",l[e]);let s=document.querySelectorAll(".calendar__day");for(let e=0;e<weekdays.length;e++)createElement("span","calendar__weekday",s[e],weekdays[e]);for(let e=0;e<a.length;e++)createElement("span","calendar__date",s[e],a[e]);var d,c;c="calendar__day--active",(d=s).forEach((e=>{e.addEventListener("click",(()=>{for(let e=0;e<d.length;e++)d[e].classList.contains(c)&&d[e].classList.remove(c);e.classList.add(c);const t=()=>{clearForm(),e.classList.remove(c),addEvent.classList.remove("popup--show"),addEvent.style.left="",addEvent.style.top="",closePopup.removeEventListener("click",t),addEventForm.removeEventListener("submit",n)},n=a=>{a.preventDefault(),createElement("div","event",e);const r=e.querySelector(".event"),o=eventTittle.value,l=eventPartisipants.value;createElement("span","event__tittle",r,o),createElement("span","event__description",r,l),e.classList.add("calendar__day--event"),clearForm(),e.classList.remove(c),addEvent.classList.remove("popup--show"),closePopup.removeEventListener("click",t),addEventForm.removeEventListener("submit",n)};e.classList.contains("calendar__day--event")||(addEvent.classList.add("popup--show"),addEvent.style.left=e.getBoundingClientRect().right+"px",addEvent.style.top=e.getBoundingClientRect().top+"px",fillDate(e),closePopup.addEventListener("click",t),addEventForm.addEventListener("submit",n))}))}))},renderCalendar=(e,t,n)=>{renderDates(e,t,n),showCurrMonthAndYear(e,t,currMonthAndYear),buttonPrev.addEventListener("click",showPrevMonthAndYear),buttonNext.addEventListener("click",showNextMonthAndYear)};renderCalendar(year,month,calendar);